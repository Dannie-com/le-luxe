<!-- /pages/checkout.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Checkout</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/styles.css" />
  <script src="https://js.paystack.co/v1/inline.js"></script>
</head>
<body class="container py-5">
  <h2 class="mb-4">Shipping Details</h2>
  <form id="checkout-form">
    <div class="mb-3">
      <label>Full Name</label>
      <input type="text" class="form-control" name="name" required />
    </div>
    <div class="mb-3">
      <label>Address</label>
      <textarea class="form-control" name="address" required></textarea>
    </div>
    <div class="mb-3">
      <label>Phone</label>
      <input type="tel" class="form-control" name="phone" required />
    </div>
    <button type="submit" class="btn btn-primary">Confirm Order</button>
  </form>
  <script src="../js/checkout.js"></script>
  <button class="btn btn-success" onclick="payWithPaystack()">Pay Now</button>

  <script>
function payWithPaystack() {
  const handler = PaystackPop.setup({
    key: 'your_public_key_here', // Replace with your Paystack public key
    email: document.getElementById('email').value,
    amount: calculateCartTotal() * 100, // kobo
    currency: "NGN",
    ref: 'ORD'+Math.floor((Math.random() * 1000000000) + 1),
    callback: function(response) {
      alert('Payment successful! Reference: ' + response.reference);
      // Save order to Firebase here
    },
    onClose: function() {
      alert('Transaction cancelled');
    }
  });
  handler.openIframe();
}

function calculateCartTotal() {
  const cart = JSON.parse(localStorage.getItem("cart")) || [];
  return cart.reduce((acc, item) => acc + item.price, 0);
}
</script>

<script>
    document.getElementById('checkoutBtn').addEventListener('click', function () {
  let totalAmount = calculateCartTotal(); // Replace this with your actual cart total logic

  let handler = PaystackPop.setup({
    key: 'YOUR_PUBLIC_KEY_HERE', // Replace with your Paystack public key
    email: 'customer@example.com', // Replace with the user's email
    amount: totalAmount * 100, // Paystack accepts kobo, so multiply by 100
    currency: 'NGN',
    ref: '' + Math.floor(Math.random() * 1000000000 + 1),
    callback: function(response) {
      alert('Payment complete! Reference: ' + response.reference);
      // Here you can clear the cart or store the order in Firebase
    },
    onClose: function() {
      alert('Payment window closed');
    }
  });

  handler.openIframe();
});


</script>
</body>
</html>
